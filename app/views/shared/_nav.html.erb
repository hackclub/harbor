<aside class="nav">
  <li>
    <% flash.each do |name, msg| %>
      <div class="flash-message <%= name %>">
        <%= msg %>
      </div>
    <% end %>
  </li>

  <% if current_user %>
    <li>
      <%= render "shared/user_mention", user: current_user %>
      <% if current_user.active_project && current_user.active_project_duration > 60 %>
        <p>
          Working on: <%= current_user.active_project %>
          (<%= short_time_simple current_user.active_project_duration %> in total)
        </p>
      <% end %>
    </li>
  <% else %>
    <li>
      <%= link_to "Login", slack_auth_path %>
    </li>
  <% end %>

  <ul>
    <li>
      <%= link_to root_path, class: "nav-item #{current_page?(root_path) ? 'active' : ''}" do %>
        Home
      <% end %>
    </li>
    <li>
      <%= link_to scrapyard_leaderboards_path, class: "nav-item #{current_page?(scrapyard_leaderboards_path) ? 'active' : ''}" do %>
        Scrapyard
      <% end %>
    </li>
    <li>
      <%= link_to leaderboards_path, class: "nav-item #{current_page?(leaderboards_path) ? 'active' : ''}" do %>
        Leaderboards
      <% end %>
    </li>
    <% if current_user %>
      <li>
        <%= link_to my_settings_path, class: "nav-item #{current_page?(my_settings_path) ? 'active' : ''}" do %>
          Settings
        <% end %>
      </li>
      <li>
        <%= link_to my_home_path, class: "nav-item #{current_page?(my_home_path) ? 'active' : ''}", data: { turbo: false } do %>
          Dashboard
        <% end %>
      </li>
      <li>
        <%= link_to signout_path, class: "nav-item", data: { turbo_method: :delete } do %>
          Logout
        <% end %>
      </li>
    <% end %>
    
    <% dev_tool(nil, "li") do %>
      <%= link_to letter_opener_web_path, class: "nav-item #{current_page?(letter_opener_web_path) ? 'active' : ''}" do %>
        Letter Opener
      <% end %>
    <% end %>
    <% admin_tool(nil, "li") do %>
      <%= link_to avo_path, class: "nav-item #{current_page?(avo_path) ? 'active' : ''}" do %>
        Avo
      <% end %>
    <% end %>
    <% admin_tool(nil, "li") do %>
      <%= link_to good_job_path, class: "nav-item #{current_page?(good_job_path) ? 'active' : ''}" do %>
        GoodJob
      <% end %>
    <% end %>
  </ul>

  <% if current_user %>
    <hr />
    
    <div class="recent-activity">
      <h3>Recent activity</h3>
      
      <div class="activity-list">
        <% ProjectMilestone.recent_for_display(10).each do |milestone| %>
          <div class="activity-item">
            <%= render "shared/user_mention", user: milestone.user %>
            <div class="activity-content">
              <p><%= milestone.formatted_message %></p>
              <div class="activity-actions">
                <% if current_user.id != milestone.user_id %>
                  <% if milestone.kudos_from?(current_user.id) %>
                    <span class="kudos-given">
                      <i class="kudos-icon">üëè</i> <%= milestone.kudos_count %>
                    </span>
                  <% else %>
                    <%= link_to give_kudos_project_milestone_path(milestone), 
                                data: { turbo_method: :post, controller: "kudos", action: "click->kudos#giveKudos" },
                                class: "give-kudos-btn" do %>
                      <i class="kudos-icon">üëè</i> Give kudos
                      <% if milestone.kudos_count > 0 %><span class="kudos-count"><%= milestone.kudos_count %></span><% end %>
                    <% end %>
                  <% end %>
                <% elsif milestone.kudos_count > 0 %>
                  <span class="kudos-received">
                    <i class="kudos-icon">üëè</i> <%= milestone.kudos_count %>
                  </span>
                <% end %>
              </div>
            </div>
            <span class="activity-time"><%= time_ago_in_words(milestone.created_at) %> ago</span>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</aside>